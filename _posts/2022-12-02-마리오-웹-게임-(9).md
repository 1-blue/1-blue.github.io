---
title: 마리오 웹 게임(9) - 마무리
author: admin
date: 2022-12-02 12:55:00 +900
categories: [Project, Mario]
tags: [WebGame, Mario]
# image:
#   path: https://user-images.githubusercontent.com/63289318/203535234-e4b8c1ed-2f5b-424f-8131-8490bf1cacd5.gif
#   width: 800
#   height: 500
#   alt: 맵 선택 및 게임 플레이 gif
---

> 본 포스트는 JS(TS)로 만든 웹 게임에 대한 마무리 포스팅입니다.
{: .prompt-info }

## 시작 목적
여태까지 웹 게임을 만들어본적이 없어서 한 번 만들어보면 어떨까라는 생각으로 시작하게 되었습니다.<br />

## 구현에 필요한 데이터
캔버스를 이용해서 화면을 렌더링할 것이기 때문에 각종 이미지 스트라이트들이 필요했습니다.<br />
인터넷 여기 저기를 찾아봐도 원하는 이미지 스프라이트가 없어서 게임에서 모션을 하나하나 캡쳐해서 포토샵을 이용해서 누끼를 따서 이미지 스프라이트를 제작했습니다.<br />

> [사용한 이미지 및 이미지 스프라이트 깃헙 링크](https://github.com/1-blue/mario/tree/master/assets/images){:target="_blank"}
{: .prompt-info }

## 구현 방식
`React`같은 프레임워크를 사용하기 보다는 일반 `TS`를 사용해서 만드는게 기본에 더 충실하고 공부에 더 도움이 되지 않을까 생각해서 `TS`만 이용해서 제작했습니다.<br />

처음에는 함수형으로 코드를 작성하려고 했지만, 만들다보니 플레이어, 적, 블록 등의 큰 덩어리들로 구분이 지어졌고 영역별로 각자의 변수와 함수를 갖도록 코드를 구현하는 것이 힘들어져서 객체지향방식으로 코드를 구성했습니다.<br />

![mario-class-diagram](https://user-images.githubusercontent.com/63289318/205248480-e0cc14d5-7744-4289-85c0-6a3d3dcc39b1.png)
_현재 구현한 클래스 다이어그램_

위 다이어그램으로 설명하자면 "캐릭터 -> 플레이어, 적", "플레이어 -> 마리오", "적 -> 굼바"와 같은 구조로 코드를 구성했습니다.<br />
그리고 각자의 공통된 필드는 상위 클래스에서 선언해서 하위에서 사용하도록 만들었고, 메서드는 동작이 일치하면 상위에서 선언하고 자식마다 다르다면 가상 메서드로 제작해서 하위 클래스에서 직접 작성하도록 구현했습니다.<br />

또한 각 매니저를 만들어서 게임의 흐름을 쉽게 제어하도록 구현했습니다.<br />
예를 들면 마리오와 굼바의 충돌에 대한 처리를 해야하는 경우에 마리오, 굼바 모두 독립적인 객체이므로 각자가 서로의 좌표를 알고 있어야 충돌에 처리가 가능했습니다.<br />
하지만 생각해보면 마리오가 모든 적들의 좌표를 알고 있는 것도 이상하고 인수로 받는다고 하더라도 마리오에서 굼바의 좌표를 받을지, 굼바에서 마리오의 좌표를 받을지 애매하기 때문에 충돌관련 코드를 처리하기 위한 매니저를 따로 만들었습니다.<br />
충돌 매니저에서 마리오, 굼바, 블록, 맵과의 충돌처리를 수행하도록 했습니다.<br />
다른 매니저들도 마찬가지로 게임의 흐름을 위해 선언하고 사용했습니다.<br />

## 게임 진행 흐름
게임의 진행은 크게 3가지로 나눠집니다.<br />

1. 게임 시작 UI<br />
게임 시작 UI에서는 맵의 종류와 타입을 선택할 수 있습니다.<br />
맵의 종류는 직선맵과 언덕맵이 있고, 맵의 타입에는 지상, 지하, 눈맵이 있습니다.<br />
![start](https://user-images.githubusercontent.com/63289318/205254405-ff3f7f3f-b34b-4e07-8be2-1adf3200bd57.gif){: width="800" height="500" }
_게임 시작 Gif_

2. 게임 플레이<br />
게임 플레이에서는 게임 시작 UI에서 고른 맵의 종류와 타입이 적용된 맵이 렌더링됩니다.<br />
걷기, 달리기, 점프(상승, 하강), 엎드리기 등의 모션이 있습니다.<br />
또한 적을 밟으면 적을 죽이고 점수가 올라가며, 적과 좌, 우, 하단에서 부딪히게 되면 적에게 죽고 게임이 종료되며 게임 종료 UI로 이동됩니다.<br />
구멍에 떨어지게 되어도 게임이 종료되고 게임 종료 UI로 이동되게 됩니다.<br />
![play](https://user-images.githubusercontent.com/63289318/205254389-bf2cb703-8635-4702-9416-219437f7c7fc.gif){: width="800" height="500" }
_게임 플레이 Gif_

3. 게임 종료 UI<br />
게임 종료 UI에서는 최종 점수를 볼 수 있고, 다시 게임하기인 시작 UI로 이동하는 버튼이 존재합니다.<br />
게임 종료 즉시 기존에 존재하던 마리오, 적, 블록등의 모든 정보는 사라지고 점수만 남게 됩니다.<br />
아마도 가비지 컬렉터에 의해서 자동적으로 메모리에서 제거될 것입니다.<br />
![end](https://user-images.githubusercontent.com/63289318/205254376-d24cc441-ecee-431d-9674-03e8808dc335.gif){: width="800" height="500" }
_게임 종료 Gif_

## 구현한 기능들
1. 게임 시작 UI에서 고른 맵의 종류와 타입에 맞는 화면 렌더링
2. 마리오 모션 ( 걷기, 달리기, 점프( 상승, 하강 ), 엎드리기 )
3. 적의 모션 ( 걷기, 죽기 )
4. 충돌처리<br />
  - 캐릭터와 맵 ( 캐릭터 이동 불가... 벽에 가로막혀서 해당 방향으로 움직임 불가능, 적의 경우 이동 방향을 변경 )<br />
  - 캐릭터와 블록 ( 캐릭터 이동 불가... 벽에 가로막혀서 해당 방향으로 움직임 불가능, 적의 경우 이동 방향을 변경 )<br />
  - 플레이어와 적 ( 충돌 방향에 따라서 플레이어나 적이 죽음... 적이 죽을 경우 점수 +100 )<br />
  - 적과 적 ( 이동 금지 및 이동 방향 변경 )<br />
5. 이동 가속 ( 1초 이상 같은 방향으로 이동하는 경우 가속, 가속 상태에서 점프 시 점프력++ )
6. 중력 ( 위로 상승 시 점점 느리게, 아래로 하강 시 점점 빠르게 움직이도록 구현 )
7. 적을 밟는 순간 점프키 누르고 있는 경우 더 높이 점프
8. 엎드려 점프 가능, 엎드려 움직임 불가능

## 해결하지 못한 버그
1. 굼바들이 부딪힐 때 통과하는 버그
2. 벽에 부딪힐 때 이동하는 경우 바닥으로 떨어지지 않는 버그

## 추가할만한 기능들
1. 마리오 커지기 ( 버섯 )
2. 게임 클리어 요소 ( 현재는 게임 클리어 조건이 없음 )
3. 타이머
4. 거북이 ( + 등껍질 )
5. 맵 이동 ( 문 )